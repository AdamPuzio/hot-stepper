!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HotStepper=t()}(this,(function(){"use strict";class e{constructor(e){this.wizard=e,this.steps=this.getSteps(),this.stepsQuantity=this.getStepsQuantity(),this.currentStep=0,this.addStepClasses()}setCurrentStep(e){this.currentStep=e,this.handleStepsClasses()}getSteps(){return this.wizard.getElementsByClassName("step")}getStepsQuantity(){return this.getSteps().length}addStepClasses(){for(let e=0;e<this.steps.length;e++){let t=this.steps[e].querySelector(".step-content");if(t){let s=0==e?'<div class="line -start"></div>':"";t.innerHTML+=`<svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n              <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>\n              <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>\n            </svg>\n            <div class="lines">\n              ${s}\n              <div class="line -background"></div>\n              <div class="line -progress"></div>\n            </div> `}}}handleConcludeStep(){this.steps[this.currentStep].classList.add("-completed")}handleStepsClasses(){for(let e=0;e<this.steps.length;e++){let t=this.steps[e];this.currentStep>e?t.classList.add("-completed"):t.classList.remove("-completed")}}handleStepsClassesOLD(e){e>0?this.steps[this.currentStep-1].classList.add("-completed"):e<0&&this.steps[this.currentStep].classList.remove("-completed")}}class t{constructor(e){this.wizard=e,this.panelWidth=this.wizard.offsetWidth,this.panelsContainer=this.getPanelsContainer(),this.panels=this.getPanels(),this.panelComplete=this.getPanelComplete(),this.currentStep=0,this.updatePanelsPosition(this.currentStep),this.updatePanelsContainerHeight()}getCurrentPanelHeight(e){return document.querySelector(".panel.movingIn").offsetHeight+"px"}getPanelsContainer(){return this.wizard.querySelector(".hs-body")}getPanels(){return this.wizard.getElementsByClassName("panel")}getPanelComplete(){return this.wizard.querySelector(".panel.complete")}addPanelClasses(){this.panelsContainer.innerHTML+='<div class="hs-mask">\n      <div class="hs-loader"><div></div><div></div><div></div></div>\n    </div>'}updatePanelsContainerHeight(){this.getPanelsContainer().style.height=this.getCurrentPanelHeight()}updatePanelsPosition(e){const t=this.panels;this.panelWidth;for(let s=0;s<t.length;s++)t[s].classList.remove("movingIn","movingOutBackward","movingOutForward"),s!==e?s<e?t[s].classList.add("movingOutBackward"):s>e&&t[s].classList.add("movingOutForward"):t[s].classList.add("movingIn");this.updatePanelsContainerHeight()}updatePanelsComplete(){if(!this.getPanelComplete())return;const e=this.panels;this.panelWidth;for(let t=0;t<e.length;t++)e[t].classList.remove("movingIn","movingOutBackward","movingOutForward"),e[t].classList.contains("complete")?e[t].classList.add("movingIn"):e[t].classList.add("movingOutBackward");this.updatePanelsContainerHeight()}setCurrentStep(e){this.currentStep=e,this.updatePanelsPosition(e)}}const s={linear:!0,animation:!1,selectors:{steps:".step",trigger:".step-trigger",stepper:".bs-stepper"},onChange:async function(e){return!0},onComplete:async function(){return!0},onReset:async function(){return!0}};return class{constructor(n,i={}){this._element=n,this._currentIndex=0,this._stepsCount=0,this._stepsContents=[],this._elements={},this.options={...s,...i},this.options.selectors={...s.selectors,...this.options.selectors},this.panels=new t(this._element),this.steps=new e(this._element),this._stepsCount=this.steps.getStepsQuantity(),this.addClasses(),this.addHandlers(),this.addListeners()}async next(){let e,t={stepFrom:this._currentIndex,stepTo:this._currentIndex+1,totalSteps:this._stepsCount,move:"forward"};return this._currentIndex+1>=this._stepsCount?(t.move="complete",e=await this.onComplete(t),!1!==e&&(this._currentIndex=this._stepsCount,this.steps.setCurrentStep(this._currentIndex),this.panels.updatePanelsComplete(),this.manageHandlers(t),void await this.complete())):(e=await this.onChange(t),!1!==e&&(this._currentIndex+=1,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(t),void this.resize()))}async previous(){if(this._currentIndex-1<0)return;let e={stepFrom:this._currentIndex,stepTo:this._currentIndex-1,totalSteps:this._stepsCount,move:"backward"};if(!1===await this.onChange(e))return!1;this._currentIndex-=1,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(e),this.resize()}async reset(){let e={stepFrom:this._currentIndex,stepTo:0,totalSteps:this._stepsCount,move:"reset"};if(!1===await this.onReset(e))return!1;this._currentIndex=0,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(e),this.resize()}complete(){!0===this.options.animation&&this._element.classList.add("completed"),this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0),this._elements.btnNext&&(this._elements.btnNext.disabled=!0)}async onChange(e){this._element.classList.add("loading");let t=await this.options.onChange.bind(this)(e);return this._element.classList.remove("loading"),t}async onComplete(e){this._element.classList.add("loading");let t=await this.options.onComplete.bind(this)(e);return this._element.classList.remove("loading"),t}async onReset(e){this._element.classList.add("loading");let t=await this.options.onReset.bind(this)(e);return this._element.classList.remove("loading"),t}addClasses(){this._element.innerHTML+='<div class="hs-mask">\n      <div class="hs-loader"><div></div><div></div><div></div></div>\n    </div>'}addHandlers(){let e=this._element.querySelector(".hs-footer");e&&(this._elements.btnNext=e.querySelector(".btn-next"),this._elements.btnPrev=e.querySelector(".btn-prev"),this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0))}manageHandlers(e){this._elements.btnPrev&&(this._elements.btnPrev.disabled=!1),this._elements.btnNext&&(this._elements.btnNext.disabled=!1),0==e.stepTo&&this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0),"complete"==e.move&&this._elements.btnNext&&(this._elements.btnNext.disabled=!0)}addListeners(){window.addEventListener("resize",this.resize)}resize(){this.panels.updatePanelsContainerHeight()}updatePanel(e,t){let s=this.panels.panels[e-1];this.updateEl(s,t)}updateEl(e,t){"string"==typeof e&&(e=document.querySelector(e));e.innerHTML=t,Array.from(e.querySelectorAll("script")).forEach(e=>{const t=document.createElement("script");Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode("(function(){ "+e.innerHTML+" })()")),e.parentNode.replaceChild(t,e)}),this.resize()}}}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvdC1zdGVwcGVyLmVzMjAxNS5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJIb3RTdGVwcGVyIiwidGhpcyIsIlN0ZXBzIiwiY29uc3RydWN0b3IiLCJ3aXphcmQiLCJzdGVwcyIsImdldFN0ZXBzIiwic3RlcHNRdWFudGl0eSIsImdldFN0ZXBzUXVhbnRpdHkiLCJjdXJyZW50U3RlcCIsImFkZFN0ZXBDbGFzc2VzIiwic2V0Q3VycmVudFN0ZXAiLCJoYW5kbGVTdGVwc0NsYXNzZXMiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwibGVuZ3RoIiwiaSIsImNvbnRlbnQiLCJxdWVyeVNlbGVjdG9yIiwic3RhcnRMaW5lIiwiaW5uZXJIVE1MIiwiaGFuZGxlQ29uY2x1ZGVTdGVwIiwiY2xhc3NMaXN0IiwiYWRkIiwic3RlcCIsInJlbW92ZSIsImhhbmRsZVN0ZXBzQ2xhc3Nlc09MRCIsIm1vdmVtZW50IiwiUGFuZWxzIiwicGFuZWxXaWR0aCIsIm9mZnNldFdpZHRoIiwicGFuZWxzQ29udGFpbmVyIiwiZ2V0UGFuZWxzQ29udGFpbmVyIiwicGFuZWxzIiwiZ2V0UGFuZWxzIiwicGFuZWxDb21wbGV0ZSIsImdldFBhbmVsQ29tcGxldGUiLCJ1cGRhdGVQYW5lbHNQb3NpdGlvbiIsInVwZGF0ZVBhbmVsc0NvbnRhaW5lckhlaWdodCIsImdldEN1cnJlbnRQYW5lbEhlaWdodCIsImRvY3VtZW50Iiwib2Zmc2V0SGVpZ2h0IiwiYWRkUGFuZWxDbGFzc2VzIiwic3R5bGUiLCJoZWlnaHQiLCJ1cGRhdGVQYW5lbHNDb21wbGV0ZSIsImNvbnRhaW5zIiwiREVGQVVMVF9PUFRJT05TIiwibGluZWFyIiwiYW5pbWF0aW9uIiwic2VsZWN0b3JzIiwidHJpZ2dlciIsInN0ZXBwZXIiLCJvbkNoYW5nZSIsImFzeW5jIiwiaW5mbyIsIm9uQ29tcGxldGUiLCJvblJlc2V0IiwiZWxlbWVudCIsIl9vcHRpb25zIiwiX2VsZW1lbnQiLCJfY3VycmVudEluZGV4IiwiX3N0ZXBzQ291bnQiLCJfc3RlcHNDb250ZW50cyIsIl9lbGVtZW50cyIsIm9wdGlvbnMiLCJhZGRDbGFzc2VzIiwiYWRkSGFuZGxlcnMiLCJhZGRMaXN0ZW5lcnMiLCJbb2JqZWN0IE9iamVjdF0iLCJyZXNwb25zZSIsInN0ZXBGcm9tIiwic3RlcFRvIiwidG90YWxTdGVwcyIsIm1vdmUiLCJtYW5hZ2VIYW5kbGVycyIsImNvbXBsZXRlIiwicmVzaXplIiwiYnRuUHJldiIsImRpc2FibGVkIiwiYnRuTmV4dCIsImJpbmQiLCJmb290ZXIiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidXBkYXRlUGFuZWwiLCJwYW5lbCIsImh0bWwiLCJlbCIsInVwZGF0ZUVsIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJvbGRTY3JpcHQiLCJuZXdTY3JpcHQiLCJjcmVhdGVFbGVtZW50IiwiYXR0cmlidXRlcyIsImF0dHIiLCJzZXRBdHRyaWJ1dGUiLCJuYW1lIiwidmFsdWUiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZVRleHROb2RlIiwicGFyZW50Tm9kZSIsInJlcGxhY2VDaGlsZCJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBVUEsRUFBUUMsR0FDRSxpQkFBWkMsU0FBMEMsb0JBQVhDLE9BQXlCQSxPQUFPRCxRQUFVRCxJQUM5RCxtQkFBWEcsUUFBeUJBLE9BQU9DLElBQU1ELE9BQU9ILElBQ25ERCxFQUFTQSxHQUFVTSxNQUFhQyxXQUFhTixJQUgvQyxDQUlDTyxNQUFNLFdBQWMsYUFLcEIsTUFBTUMsRUFDSkMsWUFBWUMsR0FDVkgsS0FBS0csT0FBU0EsRUFDZEgsS0FBS0ksTUFBUUosS0FBS0ssV0FDbEJMLEtBQUtNLGNBQWdCTixLQUFLTyxtQkFDMUJQLEtBQUtRLFlBQWMsRUFDbkJSLEtBQUtTLGlCQUdQQyxlQUFlRixHQUNiUixLQUFLUSxZQUFjQSxFQUNuQlIsS0FBS1cscUJBR1BOLFdBQ0Us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R0FDakIsSUFBSUMsRUFBS3RGLEtBQUsrQixPQUFPQSxPQUFPcUQsRUFBUSxHQUNwQ3BGLEtBQUt1RixTQUFTRCxFQUFJRCxHQUdwQkUsU0FBU0QsRUFBSUQsR0FDTSxpQkFBUEMsSUFBaUJBLEVBQUtoRCxTQUFTdEIsY0FBY3NFLElBSXZEQSxFQUFHcEUsVUFBWW1FLEVBQ2ZHLE1BQU1DLEtBQUtILEVBQUdJLGlCQUFpQixXQUFXQyxRQUFTQyxJQUNqRCxNQUFNQyxFQUFZdkQsU0FBU3dELGNBQWMsVUFDekNOLE1BQU1DLEtBQUtHLEVBQVVHLFlBQ2xCSixRQUFTSyxHQUFRSCxFQUFVSSxhQUFhRCxFQUFLRSxLQUFNRixFQUFLRyxRQUMzRE4sRUFBVU8sWUFBWTlELFNBQVMrRCxlQVB6QixnQkFPNENULEVBQVUxRSxVQU50RCxVQU9OMEUsRUFBVVUsV0FBV0MsYUFBYVYsRUFBV0QsS0FFL0M1RixLQUFLMkUiLCJmaWxlIjoiaG90LXN0ZXBwZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOlxuICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOlxuICAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5Ib3RTdGVwcGVyID0gZmFjdG9yeSgpKTtcbn0odGhpcywgZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7XG5cbiAgLypcbiAgICogU3RlcHNcbiAgICovXG4gIGNsYXNzIFN0ZXBzIHtcbiAgICBjb25zdHJ1Y3Rvcih3aXphcmQpe1xuICAgICAgdGhpcy53aXphcmQgPSB3aXphcmQ7XG4gICAgICB0aGlzLnN0ZXBzID0gdGhpcy5nZXRTdGVwcygpO1xuICAgICAgdGhpcy5zdGVwc1F1YW50aXR5ID0gdGhpcy5nZXRTdGVwc1F1YW50aXR5KCk7XG4gICAgICB0aGlzLmN1cnJlbnRTdGVwID0gMDtcbiAgICAgIHRoaXMuYWRkU3RlcENsYXNzZXMoKTtcbiAgICB9XG5cbiAgICBzZXRDdXJyZW50U3RlcChjdXJyZW50U3RlcCl7XG4gICAgICB0aGlzLmN1cnJlbnRTdGVwID0gY3VycmVudFN0ZXA7XG4gICAgICB0aGlzLmhhbmRsZVN0ZXBzQ2xhc3NlcygpO1xuICAgIH1cblxuICAgIGdldFN0ZXBzKCl7XG4gICAgICByZXR1cm4gdGhpcy53aXphcmQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3RlcCcpO1xuICAgIH1cblxuICAgIGdldFN0ZXBzUXVhbnRpdHkoKXtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0ZXBzKCkubGVuZ3RoO1xuICAgIH1cblxuICAgIGFkZFN0ZXBDbGFzc2VzKCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnN0ZXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBzdGVwID0gdGhpcy5zdGVwc1tpXTtcbiAgICAgICAgbGV0IGNvbnRlbnQgPSBzdGVwLnF1ZXJ5U2VsZWN0b3IoJy5zdGVwLWNvbnRlbnQnKTtcbiAgICAgICAgaWYoY29udGVudCkge1xuICAgICAgICAgIGxldCBzdGFydExpbmUgPSBpID09IDAgPyAnPGRpdiBjbGFzcz1cImxpbmUgLXN0YXJ0XCI+PC9kaXY+JyA6ICcnO1xuICAgICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MICs9IGA8c3ZnIGNsYXNzPVwiY2hlY2ttYXJrXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCIwIDAgNTIgNTJcIj5cbiAgICAgICAgICAgICAgPGNpcmNsZSBjbGFzcz1cImNoZWNrbWFyay1jaXJjbGVcIiBjeD1cIjI2XCIgY3k9XCIyNlwiIHI9XCIyNVwiIGZpbGw9XCJub25lXCIvPlxuICAgICAgICAgICAgICA8cGF0aCBjbGFzcz1cImNoZWNrbWFyay1jaGVja1wiIGZpbGw9XCJub25lXCIgZD1cIk0xNC4xIDI3LjJsNy4xIDcuMiAxNi43LTE2LjhcIi8+XG4gICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaW5lc1wiPlxuICAgICAgICAgICAgICAke3N0YXJ0TGluZX1cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpbmUgLWJhY2tncm91bmRcIj48L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpbmUgLXByb2dyZXNzXCI+PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj4gYDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZUNvbmNsdWRlU3RlcCgpe1xuICAgICAgdGhpcy5zdGVwc1t0aGlzLmN1cnJlbnRTdGVwXS5jbGFzc0xpc3QuYWRkKCctY29tcGxldGVkJyk7XG4gICAgfVxuXG4gICAgaGFuZGxlU3RlcHNDbGFzc2VzKCl7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgc3RlcCA9IHRoaXMuc3RlcHNbaV07XG4gICAgICAgIGlmKHRoaXMuY3VycmVudFN0ZXAgPiBpKSB7XG4gICAgICAgICAgc3RlcC5jbGFzc0xpc3QuYWRkKCctY29tcGxldGVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RlcC5jbGFzc0xpc3QucmVtb3ZlKCctY29tcGxldGVkJyk7XG4gICAgICAgIH1cbiAgICAgIH0gXG4gICAgfVxuXG4gICAgaGFuZGxlU3RlcHNDbGFzc2VzT0xEKG1vdmVtZW50KXtcbiAgICAgIGlmKG1vdmVtZW50ID4gMClcbiAgICAgICAgdGhpcy5zdGVwc1t0aGlzLmN1cnJlbnRTdGVwIC0gMV0uY2xhc3NMaXN0LmFkZCgnLWNvbXBsZXRlZCcpO1xuICAgICAgZWxzZSBpZihtb3ZlbWVudCA8IDApXG4gICAgICAgIHRoaXMuc3RlcHNbdGhpcy5jdXJyZW50U3RlcF0uY2xhc3NMaXN0LnJlbW92ZSgnLWNvbXBsZXRlZCcpOyAgXG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogUGFuZWxzXG4gICAqL1xuICBjbGFzcyBQYW5lbHMge1xuICAgIGNvbnN0cnVjdG9yKHdpemFyZCl7XG4gICAgICB0aGlzLndpemFyZCA9IHdpemFyZDtcbiAgICAgIHRoaXMucGFuZWxXaWR0aCA9IHRoaXMud2l6YXJkLm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy5wYW5lbHNDb250YWluZXIgPSB0aGlzLmdldFBhbmVsc0NvbnRhaW5lcigpO1xuICAgICAgdGhpcy5wYW5lbHMgPSB0aGlzLmdldFBhbmVscygpO1xuICAgICAgdGhpcy5wYW5lbENvbXBsZXRlID0gdGhpcy5nZXRQYW5lbENvbXBsZXRlKCk7XG4gICAgICB0aGlzLmN1cnJlbnRTdGVwID0gMDtcblxuICAgICAgdGhpcy51cGRhdGVQYW5lbHNQb3NpdGlvbih0aGlzLmN1cnJlbnRTdGVwKTtcbiAgICAgIHRoaXMudXBkYXRlUGFuZWxzQ29udGFpbmVySGVpZ2h0KCk7XG4gICAgICAvL3RoaXMuYWRkUGFuZWxDbGFzc2VzKClcbiAgICB9XG5cbiAgICBnZXRDdXJyZW50UGFuZWxIZWlnaHQoc3RlcCl7XG4gICAgICAvL3JldHVybiBgJHt0aGlzLmdldFBhbmVscygpW3N0ZXAgfHwgdGhpcy5jdXJyZW50U3RlcF0ub2Zmc2V0SGVpZ2h0fXB4YDtcbiAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFuZWwubW92aW5nSW4nKS5vZmZzZXRIZWlnaHQgKyAncHgnXG4gICAgfVxuXG4gICAgZ2V0UGFuZWxzQ29udGFpbmVyKCl7XG4gICAgICByZXR1cm4gdGhpcy53aXphcmQucXVlcnlTZWxlY3RvcignLmhzLWJvZHknKTtcbiAgICB9XG5cbiAgICBnZXRQYW5lbHMoKXtcbiAgICAgIHJldHVybiB0aGlzLndpemFyZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYW5lbCcpO1xuICAgIH1cblxuICAgIGdldFBhbmVsQ29tcGxldGUoKXtcbiAgICAgIHJldHVybiB0aGlzLndpemFyZC5xdWVyeVNlbGVjdG9yKCcucGFuZWwuY29tcGxldGUnKTtcbiAgICB9XG5cbiAgICBhZGRQYW5lbENsYXNzZXMoKSB7XG4gICAgICB0aGlzLnBhbmVsc0NvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9XCJocy1tYXNrXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiaHMtbG9hZGVyXCI+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PC9kaXY+XG4gICAgPC9kaXY+YDtcbiAgICB9XG5cbiAgICB1cGRhdGVQYW5lbHNDb250YWluZXJIZWlnaHQoKXtcbiAgICAgIHRoaXMuZ2V0UGFuZWxzQ29udGFpbmVyKCkuc3R5bGUuaGVpZ2h0ID0gdGhpcy5nZXRDdXJyZW50UGFuZWxIZWlnaHQoKTtcbiAgICAgIC8vdGhpcy5wYW5lbHNDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gdGhpcy5nZXRDdXJyZW50UGFuZWxIZWlnaHQoKVxuICAgIH1cblxuICAgIHVwZGF0ZVBhbmVsc1Bvc2l0aW9uKGN1cnJlbnRTdGVwKXtcbiAgICAgIGNvbnN0IHBhbmVscyA9IHRoaXMucGFuZWxzO1xuICAgICAgY29uc3QgcGFuZWxXaWR0aCA9IHRoaXMucGFuZWxXaWR0aDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYW5lbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcGFuZWxzW2ldLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAgICAgICdtb3ZpbmdJbicsXG4gICAgICAgICAgICdtb3ZpbmdPdXRCYWNrd2FyZCcsXG4gICAgICAgICAgICdtb3ZpbmdPdXRGb3J3YXJkJ1xuICAgICAgICApO1xuXG4gICAgICAgIGlmKGkgIT09IGN1cnJlbnRTdGVwKXtcbiAgICAgICAgICBpZihpIDwgY3VycmVudFN0ZXApIHBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKCdtb3ZpbmdPdXRCYWNrd2FyZCcpO1xuICAgICAgICAgIGVsc2UgaWYoIGkgPiBjdXJyZW50U3RlcCApIHBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKCdtb3ZpbmdPdXRGb3J3YXJkJyk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKCdtb3ZpbmdJbicpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUGFuZWxzQ29udGFpbmVySGVpZ2h0KCk7XG4gICAgfVxuXG4gICAgdXBkYXRlUGFuZWxzQ29tcGxldGUoKSB7XG4gICAgICBjb25zdCBjb21wbGV0ZVBhbmVsID0gdGhpcy5nZXRQYW5lbENvbXBsZXRlKCk7XG4gICAgICBpZighY29tcGxldGVQYW5lbCkgcmV0dXJuXG4gICAgICBjb25zdCBwYW5lbHMgPSB0aGlzLnBhbmVscztcbiAgICAgIGNvbnN0IHBhbmVsV2lkdGggPSB0aGlzLnBhbmVsV2lkdGg7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFuZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHBhbmVsc1tpXS5jbGFzc0xpc3QucmVtb3ZlKFxuICAgICAgICAgICAnbW92aW5nSW4nLFxuICAgICAgICAgICAnbW92aW5nT3V0QmFja3dhcmQnLFxuICAgICAgICAgICAnbW92aW5nT3V0Rm9yd2FyZCdcbiAgICAgICAgKTtcblxuICAgICAgICBpZihwYW5lbHNbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZScpKSB7XG4gICAgICAgICAgcGFuZWxzW2ldLmNsYXNzTGlzdC5hZGQoJ21vdmluZ0luJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFuZWxzW2ldLmNsYXNzTGlzdC5hZGQoJ21vdmluZ091dEJhY2t3YXJkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVQYW5lbHNDb250YWluZXJIZWlnaHQoKTtcbiAgICB9XG5cbiAgICBzZXRDdXJyZW50U3RlcChjdXJyZW50U3RlcCl7XG4gICAgICB0aGlzLmN1cnJlbnRTdGVwID0gY3VycmVudFN0ZXA7XG4gICAgICB0aGlzLnVwZGF0ZVBhbmVsc1Bvc2l0aW9uKGN1cnJlbnRTdGVwKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBERUZBVUxUX09QVElPTlMgPSB7XG4gICAgbGluZWFyOiB0cnVlLFxuICAgIGFuaW1hdGlvbjogZmFsc2UsXG4gICAgc2VsZWN0b3JzOiB7XG4gICAgICBzdGVwczogJy5zdGVwJyxcbiAgICAgIHRyaWdnZXI6ICcuc3RlcC10cmlnZ2VyJyxcbiAgICAgIHN0ZXBwZXI6ICcuYnMtc3RlcHBlcidcbiAgICB9LFxuICAgIG9uQ2hhbmdlOiBhc3luYyBmdW5jdGlvbihpbmZvKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gICAgb25Db21wbGV0ZTogYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gICAgb25SZXNldDogYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfTtcblxuICBjbGFzcyBIb3RTdGVwcGVyIHtcbiAgICBjb25zdHJ1Y3RvciAoZWxlbWVudCwgX29wdGlvbnMgPSB7fSkge1xuICAgICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICB0aGlzLl9jdXJyZW50SW5kZXggPSAwO1xuICAgICAgdGhpcy5fc3RlcHNDb3VudCA9IDA7XG4gICAgICB0aGlzLl9zdGVwc0NvbnRlbnRzID0gW107XG4gICAgICB0aGlzLl9lbGVtZW50cyA9IHt9O1xuXG4gICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgIC4uLkRFRkFVTFRfT1BUSU9OUyxcbiAgICAgICAgLi4uX29wdGlvbnNcbiAgICAgIH07XG5cbiAgICAgIHRoaXMub3B0aW9ucy5zZWxlY3RvcnMgPSB7XG4gICAgICAgIC4uLkRFRkFVTFRfT1BUSU9OUy5zZWxlY3RvcnMsXG4gICAgICAgIC4uLnRoaXMub3B0aW9ucy5zZWxlY3RvcnNcbiAgICAgIH07XG5cbiAgICAgIHRoaXMucGFuZWxzID0gbmV3IFBhbmVscyh0aGlzLl9lbGVtZW50KTtcbiAgICAgIHRoaXMuc3RlcHMgPSBuZXcgU3RlcHModGhpcy5fZWxlbWVudCk7XG4gICAgICB0aGlzLl9zdGVwc0NvdW50ID0gdGhpcy5zdGVwcy5nZXRTdGVwc1F1YW50aXR5KCk7XG4gICAgICB0aGlzLmFkZENsYXNzZXMoKTtcbiAgICAgIHRoaXMuYWRkSGFuZGxlcnMoKTtcbiAgICAgIHRoaXMuYWRkTGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgbmV4dCAoKSB7XG4gICAgICBsZXQgcmVzcG9uc2U7XG4gICAgICBsZXQgaW5mbyA9IHtcbiAgICAgICAgc3RlcEZyb206IHRoaXMuX2N1cnJlbnRJbmRleCxcbiAgICAgICAgc3RlcFRvOiB0aGlzLl9jdXJyZW50SW5kZXggKyAxLFxuICAgICAgICB0b3RhbFN0ZXBzOiB0aGlzLl9zdGVwc0NvdW50LFxuICAgICAgICBtb3ZlOiAnZm9yd2FyZCdcbiAgICAgIH07XG4gICAgICBpZih0aGlzLl9jdXJyZW50SW5kZXggKyAxID49IHRoaXMuX3N0ZXBzQ291bnQpIHtcbiAgICAgICAgaW5mby5tb3ZlID0gJ2NvbXBsZXRlJztcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9uQ29tcGxldGUoaW5mbyk7XG4gICAgICAgIGlmKHJlc3BvbnNlID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlXG4gICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IHRoaXMuX3N0ZXBzQ291bnQ7XG4gICAgICAgIHRoaXMuc3RlcHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgICAgdGhpcy5wYW5lbHMudXBkYXRlUGFuZWxzQ29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5tYW5hZ2VIYW5kbGVycyhpbmZvKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jb21wbGV0ZSgpO1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vbkNoYW5nZShpbmZvKTtcbiAgICAgIGlmKHJlc3BvbnNlID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlXG4gICAgICB0aGlzLl9jdXJyZW50SW5kZXggKz0gMTtcbiAgICAgIHRoaXMuc3RlcHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgIHRoaXMucGFuZWxzLnNldEN1cnJlbnRTdGVwKHRoaXMuX2N1cnJlbnRJbmRleCk7XG4gICAgICB0aGlzLm1hbmFnZUhhbmRsZXJzKGluZm8pO1xuICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9XG5cbiAgICBhc3luYyBwcmV2aW91cyAoKSB7XG4gICAgICBpZih0aGlzLl9jdXJyZW50SW5kZXggLSAxIDwgMCkgcmV0dXJuXG4gICAgICBsZXQgaW5mbyA9IHtcbiAgICAgICAgc3RlcEZyb206IHRoaXMuX2N1cnJlbnRJbmRleCxcbiAgICAgICAgc3RlcFRvOiB0aGlzLl9jdXJyZW50SW5kZXggLSAxLFxuICAgICAgICB0b3RhbFN0ZXBzOiB0aGlzLl9zdGVwc0NvdW50LFxuICAgICAgICBtb3ZlOiAnYmFja3dhcmQnXG4gICAgICB9O1xuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vbkNoYW5nZShpbmZvKTtcbiAgICAgIGlmKHJlc3BvbnNlID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlXG4gICAgICB0aGlzLl9jdXJyZW50SW5kZXggLT0gMTtcbiAgICAgIHRoaXMuc3RlcHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgIHRoaXMucGFuZWxzLnNldEN1cnJlbnRTdGVwKHRoaXMuX2N1cnJlbnRJbmRleCk7XG4gICAgICB0aGlzLm1hbmFnZUhhbmRsZXJzKGluZm8pO1xuICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9XG5cbiAgICBhc3luYyByZXNldCAoKSB7XG4gICAgICBsZXQgaW5mbyA9IHtcbiAgICAgICAgc3RlcEZyb206IHRoaXMuX2N1cnJlbnRJbmRleCxcbiAgICAgICAgc3RlcFRvOiAwLFxuICAgICAgICB0b3RhbFN0ZXBzOiB0aGlzLl9zdGVwc0NvdW50LFxuICAgICAgICBtb3ZlOiAncmVzZXQnXG4gICAgICB9O1xuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vblJlc2V0KGluZm8pO1xuICAgICAgaWYocmVzcG9uc2UgPT09IGZhbHNlKSByZXR1cm4gZmFsc2VcbiAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IDA7XG4gICAgICB0aGlzLnN0ZXBzLnNldEN1cnJlbnRTdGVwKHRoaXMuX2N1cnJlbnRJbmRleCk7XG4gICAgICB0aGlzLnBhbmVscy5zZXRDdXJyZW50U3RlcCh0aGlzLl9jdXJyZW50SW5kZXgpO1xuICAgICAgdGhpcy5tYW5hZ2VIYW5kbGVycyhpbmZvKTtcbiAgICAgIHRoaXMucmVzaXplKCk7XG4gICAgfVxuXG4gICAgY29tcGxldGUgKCkge1xuICAgICAgaWYodGhpcy5vcHRpb25zLmFuaW1hdGlvbiA9PT0gdHJ1ZSlcbiAgICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgIGlmKHRoaXMuX2VsZW1lbnRzLmJ0blByZXYpIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgaWYodGhpcy5fZWxlbWVudHMuYnRuTmV4dCkgdGhpcy5fZWxlbWVudHMuYnRuTmV4dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgb25DaGFuZ2UgKGluZm8pIHtcbiAgICAgIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vcHRpb25zLm9uQ2hhbmdlLmJpbmQodGhpcykoaW5mbyk7XG4gICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmcnKTtcbiAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cblxuICAgIGFzeW5jIG9uQ29tcGxldGUgKGluZm8pIHtcbiAgICAgIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vcHRpb25zLm9uQ29tcGxldGUuYmluZCh0aGlzKShpbmZvKTtcbiAgICAgIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuXG4gICAgYXN5bmMgb25SZXNldCAoaW5mbykge1xuICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdsb2FkaW5nJyk7XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9wdGlvbnMub25SZXNldC5iaW5kKHRoaXMpKGluZm8pO1xuICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nJyk7XG4gICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG5cbiAgICBhZGRDbGFzc2VzKCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9XCJocy1tYXNrXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiaHMtbG9hZGVyXCI+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PC9kaXY+XG4gICAgPC9kaXY+YDtcbiAgICB9XG5cbiAgICBhZGRIYW5kbGVycygpIHtcbiAgICAgIGxldCBmb290ZXIgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ocy1mb290ZXInKTtcbiAgICAgIGlmKCFmb290ZXIpIHJldHVyblxuICAgICAgdGhpcy5fZWxlbWVudHMuYnRuTmV4dCA9IGZvb3Rlci5xdWVyeVNlbGVjdG9yKCcuYnRuLW5leHQnKTtcbiAgICAgIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYgPSBmb290ZXIucXVlcnlTZWxlY3RvcignLmJ0bi1wcmV2Jyk7XG4gICAgICBpZih0aGlzLl9lbGVtZW50cy5idG5QcmV2KSB0aGlzLl9lbGVtZW50cy5idG5QcmV2LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBtYW5hZ2VIYW5kbGVycyhpbmZvKSB7XG4gICAgICBpZih0aGlzLl9lbGVtZW50cy5idG5QcmV2KSB0aGlzLl9lbGVtZW50cy5idG5QcmV2LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBpZih0aGlzLl9lbGVtZW50cy5idG5OZXh0KSB0aGlzLl9lbGVtZW50cy5idG5OZXh0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBpZihpbmZvLnN0ZXBUbyA9PSAwICYmIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYpXG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgaWYoaW5mby5tb3ZlID09ICdjb21wbGV0ZScgJiYgdGhpcy5fZWxlbWVudHMuYnRuTmV4dClcbiAgICAgICAgdGhpcy5fZWxlbWVudHMuYnRuTmV4dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgYWRkTGlzdGVuZXJzKCkge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMucmVzaXplKTtcbiAgICB9XG5cbiAgICByZXNpemUoKSB7XG4gICAgICB0aGlzLnBhbmVscy51cGRhdGVQYW5lbHNDb250YWluZXJIZWlnaHQoKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQYW5lbChwYW5lbCwgaHRtbCkge1xuICAgICAgbGV0IGVsID0gdGhpcy5wYW5lbHMucGFuZWxzW3BhbmVsIC0gMV07XG4gICAgICB0aGlzLnVwZGF0ZUVsKGVsLCBodG1sKTtcbiAgICB9XG5cbiAgICB1cGRhdGVFbChlbCwgaHRtbCkge1xuICAgICAgaWYodHlwZW9mIGVsID09PSAnc3RyaW5nJykgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsKTtcbiAgICAgIC8vbGV0IGVsID0gdGhpcy5wYW5lbHMucGFuZWxzW3BhbmVsIC0gMV1cbiAgICAgIGxldCBhID0gJyhmdW5jdGlvbigpeyAnO1xuICAgICAgbGV0IGIgPSAnIH0pKCknO1xuICAgICAgZWwuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIEFycmF5LmZyb20oZWwucXVlcnlTZWxlY3RvckFsbChcInNjcmlwdFwiKSkuZm9yRWFjaCggb2xkU2NyaXB0ID0+IHtcbiAgICAgICAgY29uc3QgbmV3U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgQXJyYXkuZnJvbShvbGRTY3JpcHQuYXR0cmlidXRlcylcbiAgICAgICAgICAuZm9yRWFjaCggYXR0ciA9PiBuZXdTY3JpcHQuc2V0QXR0cmlidXRlKGF0dHIubmFtZSwgYXR0ci52YWx1ZSkgKTtcbiAgICAgICAgbmV3U2NyaXB0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGEgKyBvbGRTY3JpcHQuaW5uZXJIVE1MICsgYikpO1xuICAgICAgICBvbGRTY3JpcHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3U2NyaXB0LCBvbGRTY3JpcHQpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBIb3RTdGVwcGVyO1xuXG59KSk7XG4iXX0=
