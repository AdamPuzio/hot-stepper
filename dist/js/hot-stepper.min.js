!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HotStepper=t()}(this,(function(){"use strict";class e{constructor(e){this.wizard=e,this.steps=this.getSteps(),this.stepsQuantity=this.getStepsQuantity(),this.currentStep=0,this.addStepClasses()}setCurrentStep(e){this.currentStep=e,this.handleStepsClasses()}getSteps(){return this.wizard.getElementsByClassName("step")}getStepsQuantity(){return this.getSteps().length}addStepClasses(){for(let e=0;e<this.steps.length;e++){let t=this.steps[e].querySelector(".step-content");if(t){let s=0==e?'<div class="line -start"></div>':"";t.innerHTML+=`<svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n              <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>\n              <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>\n            </svg>\n            <div class="lines">\n              ${s}\n              <div class="line -background"></div>\n              <div class="line -progress"></div>\n            </div> `}}}handleConcludeStep(){this.steps[this.currentStep].classList.add("-completed")}handleStepsClasses(){for(let e=0;e<this.steps.length;e++){let t=this.steps[e];this.currentStep>e?t.classList.add("-completed"):t.classList.remove("-completed")}}handleStepsClassesOLD(e){e>0?this.steps[this.currentStep-1].classList.add("-completed"):e<0&&this.steps[this.currentStep].classList.remove("-completed")}}class t{constructor(e){this.wizard=e,this.panelWidth=this.wizard.offsetWidth,this.panelsContainer=this.getPanelsContainer(),this.panels=this.getPanels(),this.panelComplete=this.getPanelComplete(),this.currentStep=0,this.updatePanelsPosition(this.currentStep),this.updatePanelsContainerHeight()}getCurrentPanelHeight(e){return document.querySelector(".panel.movingIn").offsetHeight+"px"}getPanelsContainer(){return this.wizard.querySelector(".hs-body")}getPanels(){return this.wizard.getElementsByClassName("panel")}getPanelComplete(){return this.wizard.querySelector(".panel.complete")}addPanelClasses(){this.panelsContainer.innerHTML+='<div class="hs-mask">\n      <div class="hs-loader"><div></div><div></div><div></div></div>\n    </div>'}updatePanelsContainerHeight(){this.getPanelsContainer().style.height=this.getCurrentPanelHeight()}updatePanelsPosition(e){const t=this.panels;this.panelWidth;for(let s=0;s<t.length;s++)t[s].classList.remove("movingIn","movingOutBackward","movingOutForward"),s!==e?s<e?t[s].classList.add("movingOutBackward"):s>e&&t[s].classList.add("movingOutForward"):t[s].classList.add("movingIn");this.updatePanelsContainerHeight()}updatePanelsComplete(){if(!this.getPanelComplete())return;const e=this.panels;this.panelWidth;for(let t=0;t<e.length;t++)e[t].classList.remove("movingIn","movingOutBackward","movingOutForward"),e[t].classList.contains("complete")?e[t].classList.add("movingIn"):e[t].classList.add("movingOutBackward");this.updatePanelsContainerHeight()}setCurrentStep(e){this.currentStep=e,this.updatePanelsPosition(e)}}const s={linear:!0,animation:!1,selectors:{steps:".step",trigger:".step-trigger",stepper:".bs-stepper"},onChange:async function(e){return!0},onComplete:async function(){return!0},onReset:async function(){return!0}};return class{constructor(n,i={}){"string"==typeof n&&(n=document.querySelector(n)),this._element=n,this._currentIndex=0,this._stepsCount=0,this._stepsContents=[],this._elements={},this.options={...s,...i},this.options.selectors={...s.selectors,...this.options.selectors},this.panels=new t(this._element),this.steps=new e(this._element),this._stepsCount=this.steps.getStepsQuantity(),this.addClasses(),this.addHandlers(),this.addListeners()}async next(){let e,t={stepFrom:this._currentIndex,stepTo:this._currentIndex+1,totalSteps:this._stepsCount,move:"forward"};return this._currentIndex+1>=this._stepsCount?(t.move="complete",e=await this.onComplete(t),!1!==e&&(this._currentIndex=this._stepsCount,this.steps.setCurrentStep(this._currentIndex),this.panels.updatePanelsComplete(),this.manageHandlers(t),void await this.complete())):(e=await this.onChange(t),!1!==e&&(this._currentIndex+=1,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(t),void this.resize()))}async previous(){if(this._currentIndex-1<0)return;let e={stepFrom:this._currentIndex,stepTo:this._currentIndex-1,totalSteps:this._stepsCount,move:"backward"};if(!1===await this.onChange(e))return!1;this._currentIndex-=1,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(e),this.resize()}async reset(){let e={stepFrom:this._currentIndex,stepTo:0,totalSteps:this._stepsCount,move:"reset"};if(!1===await this.onReset(e))return!1;this._currentIndex=0,this.steps.setCurrentStep(this._currentIndex),this.panels.setCurrentStep(this._currentIndex),this.manageHandlers(e),this.resize()}complete(){!0===this.options.animation&&this._element.classList.add("completed"),this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0),this._elements.btnNext&&(this._elements.btnNext.disabled=!0)}async onChange(e){this._element.classList.add("loading");let t=await this.options.onChange.bind(this)(e);return this._element.classList.remove("loading"),t}async onComplete(e){this._element.classList.add("loading");let t=await this.options.onComplete.bind(this)(e);return this._element.classList.remove("loading"),t}async onReset(e){this._element.classList.add("loading");let t=await this.options.onReset.bind(this)(e);return this._element.classList.remove("loading"),t}addClasses(){this._element.innerHTML+='<div class="hs-mask">\n      <div class="hs-loader"><div></div><div></div><div></div></div>\n    </div>'}addHandlers(){let e=this._element.querySelector(".hs-footer");e&&(this._elements.btnNext=e.querySelector(".btn-next"),this._elements.btnPrev=e.querySelector(".btn-prev"),this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0))}manageHandlers(e){this._elements.btnPrev&&(this._elements.btnPrev.disabled=!1),this._elements.btnNext&&(this._elements.btnNext.disabled=!1),0==e.stepTo&&this._elements.btnPrev&&(this._elements.btnPrev.disabled=!0),"complete"==e.move&&this._elements.btnNext&&(this._elements.btnNext.disabled=!0)}addListeners(){window.addEventListener("resize",this.resize)}resize(){this.panels.updatePanelsContainerHeight()}updatePanel(e,t){let s=this.panels.panels[e-1];this.updateEl(s,t)}updateEl(e,t){"string"==typeof e&&(e=document.querySelector(e));e.innerHTML=t,Array.from(e.querySelectorAll("script")).forEach(e=>{const t=document.createElement("script");Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode("(function(){ "+e.innerHTML+" })()")),e.parentNode.replaceChild(t,e)}),this.resize()}}}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvdC1zdGVwcGVyLmVzMjAxNS5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJIb3RTdGVwcGVyIiwidGhpcyIsIlN0ZXBzIiwiY29uc3RydWN0b3IiLCJ3aXphcmQiLCJzdGVwcyIsImdldFN0ZXBzIiwic3RlcHNRdWFudGl0eSIsImdldFN0ZXBzUXVhbnRpdHkiLCJjdXJyZW50U3RlcCIsImFkZFN0ZXBDbGFzc2VzIiwic2V0Q3VycmVudFN0ZXAiLCJoYW5kbGVTdGVwc0NsYXNzZXMiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwibGVuZ3RoIiwiaSIsImNvbnRlbnQiLCJxdWVyeVNlbGVjdG9yIiwic3RhcnRMaW5lIiwiaW5uZXJIVE1MIiwiaGFuZGxlQ29uY2x1ZGVTdGVwIiwiY2xhc3NMaXN0IiwiYWRkIiwic3RlcCIsInJlbW92ZSIsImhhbmRsZVN0ZXBzQ2xhc3Nlc09MRCIsIm1vdmVtZW50IiwiUGFuZWxzIiwicGFuZWxXaWR0aCIsIm9mZnNldFdpZHRoIiwicGFuZWxzQ29udGFpbmVyIiwiZ2V0UGFuZWxzQ29udGFpbmVyIiwicGFuZWxzIiwiZ2V0UGFuZWxzIiwicGFuZWxDb21wbGV0ZSIsImdldFBhbmVsQ29tcGxldGUiLCJ1cGRhdGVQYW5lbHNQb3NpdGlvbiIsInVwZGF0ZVBhbmVsc0NvbnRhaW5lckhlaWdodCIsImdldEN1cnJlbnRQYW5lbEhlaWdodCIsImRvY3VtZW50Iiwib2Zmc2V0SGVpZ2h0IiwiYWRkUGFuZWxDbGFzc2VzIiwic3R5bGUiLCJoZWlnaHQiLCJ1cGRhdGVQYW5lbHNDb21wbGV0ZSIsImNvbnRhaW5zIiwiREVGQVVMVF9PUFRJT05TIiwibGluZWFyIiwiYW5pbWF0aW9uIiwic2VsZWN0b3JzIiwidHJpZ2dlciIsInN0ZXBwZXIiLCJvbkNoYW5nZSIsImFzeW5jIiwiaW5mbyIsIm9uQ29tcGxldGUiLCJvblJlc2V0IiwiZWxlbWVudCIsIl9vcHRpb25zIiwiX2VsZW1lbnQiLCJfY3VycmVudEluZGV4IiwiX3N0ZXBzQ291bnQiLCJfc3RlcHNDb250ZW50cyIsIl9lbGVtZW50cyIsIm9wdGlvbnMiLCJhZGRDbGFzc2VzIiwiYWRkSGFuZGxlcnMiLCJhZGRMaXN0ZW5lcnMiLCJbb2JqZWN0IE9iamVjdF0iLCJyZXNwb25zZSIsInN0ZXBGcm9tIiwic3RlcFRvIiwidG90YWxTdGVwcyIsIm1vdmUiLCJtYW5hZ2VIYW5kbGVycyIsImNvbXBsZXRlIiwicmVzaXplIiwiYnRuUHJldiIsImRpc2FibGVkIiwiYnRuTmV4dCIsImJpbmQiLCJmb290ZXIiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidXBkYXRlUGFuZWwiLCJwYW5lbCIsImh0bWwiLCJlbCIsInVwZGF0ZUVsIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJvbGRTY3JpcHQiLCJuZXdTY3JpcHQiLCJjcmVhdGVFbGVtZW50IiwiYXR0cmlidXRlcyIsImF0dHIiLCJzZXRBdHRyaWJ1dGUiLCJuYW1lIiwidmFsdWUiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZVRleHROb2RlIiwicGFyZW50Tm9kZSIsInJlcGxhY2VDaGlsZCJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBVUEsRUFBUUMsR0FDRSxpQkFBWkMsU0FBMEMsb0JBQVhDLE9BQXlCQSxPQUFPRCxRQUFVRCxJQUM5RCxtQkFBWEcsUUFBeUJBLE9BQU9DLElBQU1ELE9BQU9ILElBQ25ERCxFQUFTQSxHQUFVTSxNQUFhQyxXQUFhTixJQUgvQyxDQUlDTyxNQUFNLFdBQWMsYUFLcEIsTUFBTUMsRUFDSkMsWUFBWUMsR0FDVkgsS0FBS0csT0FBU0EsRUFDZEgsS0FBS0ksTUFBUUosS0FBS0ssV0FDbEJMLEtBQUtNLGNBQWdCTixLQUFLTyxtQkFDMUJQLEtBQUtRLFlBQWMsRUFDbkJSLEtBQUtTLGlCQUdQQyxlQUFlRixHQUNiUixLQUFLUSxZQUFjQSxFQUNuQlIsS0FBS1cscUJBR1BOLFdBQ0Us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U0FDRTNFLEtBQUsrQixPQUFPSyw4QkFHZCtDLFlBQVlDLEVBQU9DLEdBQ2pCLElBQUlDLEVBQUt0RixLQUFLK0IsT0FBT0EsT0FBT3FELEVBQVEsR0FDcENwRixLQUFLdUYsU0FBU0QsRUFBSUQsR0FHcEJFLFNBQVNELEVBQUlELEdBQ00saUJBQVBDLElBQWlCQSxFQUFLaEQsU0FBU3RCLGNBQWNzRSxJQUl2REEsRUFBR3BFLFVBQVltRSxFQUNmRyxNQUFNQyxLQUFLSCxFQUFHSSxpQkFBaUIsV0FBV0MsUUFBU0MsSUFDakQsTUFBTUMsRUFBWXZELFNBQVN3RCxjQUFjLFVBQ3pDTixNQUFNQyxLQUFLRyxFQUFVRyxZQUNsQkosUUFBU0ssR0FBUUgsRUFBVUksYUFBYUQsRUFBS0UsS0FBTUYsRUFBS0csUUFDM0ROLEVBQVVPLFlBQVk5RCxTQUFTK0QsZUFQekIsZ0JBTzRDVCxFQUFVMUUsVUFOdEQsVUFPTjBFLEVBQVVVLFdBQVdDLGFBQWFWLEVBQVdELEtBRS9DNUYsS0FBSzJFIiwiZmlsZSI6ImhvdC1zdGVwcGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcbiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcbiAgKGdsb2JhbCA9IGdsb2JhbCB8fCBzZWxmLCBnbG9iYWwuSG90U3RlcHBlciA9IGZhY3RvcnkoKSk7XG59KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qXG4gICAqIFN0ZXBzXG4gICAqL1xuICBjbGFzcyBTdGVwcyB7XG4gICAgY29uc3RydWN0b3Iod2l6YXJkKXtcbiAgICAgIHRoaXMud2l6YXJkID0gd2l6YXJkO1xuICAgICAgdGhpcy5zdGVwcyA9IHRoaXMuZ2V0U3RlcHMoKTtcbiAgICAgIHRoaXMuc3RlcHNRdWFudGl0eSA9IHRoaXMuZ2V0U3RlcHNRdWFudGl0eSgpO1xuICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IDA7XG4gICAgICB0aGlzLmFkZFN0ZXBDbGFzc2VzKCk7XG4gICAgfVxuXG4gICAgc2V0Q3VycmVudFN0ZXAoY3VycmVudFN0ZXApe1xuICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IGN1cnJlbnRTdGVwO1xuICAgICAgdGhpcy5oYW5kbGVTdGVwc0NsYXNzZXMoKTtcbiAgICB9XG5cbiAgICBnZXRTdGVwcygpe1xuICAgICAgcmV0dXJuIHRoaXMud2l6YXJkLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3N0ZXAnKTtcbiAgICB9XG5cbiAgICBnZXRTdGVwc1F1YW50aXR5KCl7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdGVwcygpLmxlbmd0aDtcbiAgICB9XG5cbiAgICBhZGRTdGVwQ2xhc3NlcygpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgc3RlcCA9IHRoaXMuc3RlcHNbaV07XG4gICAgICAgIGxldCBjb250ZW50ID0gc3RlcC5xdWVyeVNlbGVjdG9yKCcuc3RlcC1jb250ZW50Jyk7XG4gICAgICAgIGlmKGNvbnRlbnQpIHtcbiAgICAgICAgICBsZXQgc3RhcnRMaW5lID0gaSA9PSAwID8gJzxkaXYgY2xhc3M9XCJsaW5lIC1zdGFydFwiPjwvZGl2PicgOiAnJztcbiAgICAgICAgICBjb250ZW50LmlubmVySFRNTCArPSBgPHN2ZyBjbGFzcz1cImNoZWNrbWFya1wiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2aWV3Qm94PVwiMCAwIDUyIDUyXCI+XG4gICAgICAgICAgICAgIDxjaXJjbGUgY2xhc3M9XCJjaGVja21hcmstY2lyY2xlXCIgY3g9XCIyNlwiIGN5PVwiMjZcIiByPVwiMjVcIiBmaWxsPVwibm9uZVwiLz5cbiAgICAgICAgICAgICAgPHBhdGggY2xhc3M9XCJjaGVja21hcmstY2hlY2tcIiBmaWxsPVwibm9uZVwiIGQ9XCJNMTQuMSAyNy4ybDcuMSA3LjIgMTYuNy0xNi44XCIvPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibGluZXNcIj5cbiAgICAgICAgICAgICAgJHtzdGFydExpbmV9XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaW5lIC1iYWNrZ3JvdW5kXCI+PC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaW5lIC1wcm9ncmVzc1wiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+IGA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVDb25jbHVkZVN0ZXAoKXtcbiAgICAgIHRoaXMuc3RlcHNbdGhpcy5jdXJyZW50U3RlcF0uY2xhc3NMaXN0LmFkZCgnLWNvbXBsZXRlZCcpO1xuICAgIH1cblxuICAgIGhhbmRsZVN0ZXBzQ2xhc3Nlcygpe1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc3RlcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHN0ZXAgPSB0aGlzLnN0ZXBzW2ldO1xuICAgICAgICBpZih0aGlzLmN1cnJlbnRTdGVwID4gaSkge1xuICAgICAgICAgIHN0ZXAuY2xhc3NMaXN0LmFkZCgnLWNvbXBsZXRlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0ZXAuY2xhc3NMaXN0LnJlbW92ZSgnLWNvbXBsZXRlZCcpO1xuICAgICAgICB9XG4gICAgICB9IFxuICAgIH1cblxuICAgIGhhbmRsZVN0ZXBzQ2xhc3Nlc09MRChtb3ZlbWVudCl7XG4gICAgICBpZihtb3ZlbWVudCA+IDApXG4gICAgICAgIHRoaXMuc3RlcHNbdGhpcy5jdXJyZW50U3RlcCAtIDFdLmNsYXNzTGlzdC5hZGQoJy1jb21wbGV0ZWQnKTtcbiAgICAgIGVsc2UgaWYobW92ZW1lbnQgPCAwKVxuICAgICAgICB0aGlzLnN0ZXBzW3RoaXMuY3VycmVudFN0ZXBdLmNsYXNzTGlzdC5yZW1vdmUoJy1jb21wbGV0ZWQnKTsgIFxuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqIFBhbmVsc1xuICAgKi9cbiAgY2xhc3MgUGFuZWxzIHtcbiAgICBjb25zdHJ1Y3Rvcih3aXphcmQpe1xuICAgICAgdGhpcy53aXphcmQgPSB3aXphcmQ7XG4gICAgICB0aGlzLnBhbmVsV2lkdGggPSB0aGlzLndpemFyZC5vZmZzZXRXaWR0aDtcbiAgICAgIHRoaXMucGFuZWxzQ29udGFpbmVyID0gdGhpcy5nZXRQYW5lbHNDb250YWluZXIoKTtcbiAgICAgIHRoaXMucGFuZWxzID0gdGhpcy5nZXRQYW5lbHMoKTtcbiAgICAgIHRoaXMucGFuZWxDb21wbGV0ZSA9IHRoaXMuZ2V0UGFuZWxDb21wbGV0ZSgpO1xuICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IDA7XG5cbiAgICAgIHRoaXMudXBkYXRlUGFuZWxzUG9zaXRpb24odGhpcy5jdXJyZW50U3RlcCk7XG4gICAgICB0aGlzLnVwZGF0ZVBhbmVsc0NvbnRhaW5lckhlaWdodCgpO1xuICAgICAgLy90aGlzLmFkZFBhbmVsQ2xhc3NlcygpXG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudFBhbmVsSGVpZ2h0KHN0ZXApe1xuICAgICAgLy9yZXR1cm4gYCR7dGhpcy5nZXRQYW5lbHMoKVtzdGVwIHx8IHRoaXMuY3VycmVudFN0ZXBdLm9mZnNldEhlaWdodH1weGA7XG4gICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhbmVsLm1vdmluZ0luJykub2Zmc2V0SGVpZ2h0ICsgJ3B4J1xuICAgIH1cblxuICAgIGdldFBhbmVsc0NvbnRhaW5lcigpe1xuICAgICAgcmV0dXJuIHRoaXMud2l6YXJkLnF1ZXJ5U2VsZWN0b3IoJy5ocy1ib2R5Jyk7XG4gICAgfVxuXG4gICAgZ2V0UGFuZWxzKCl7XG4gICAgICByZXR1cm4gdGhpcy53aXphcmQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncGFuZWwnKTtcbiAgICB9XG5cbiAgICBnZXRQYW5lbENvbXBsZXRlKCl7XG4gICAgICByZXR1cm4gdGhpcy53aXphcmQucXVlcnlTZWxlY3RvcignLnBhbmVsLmNvbXBsZXRlJyk7XG4gICAgfVxuXG4gICAgYWRkUGFuZWxDbGFzc2VzKCkge1xuICAgICAgdGhpcy5wYW5lbHNDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPVwiaHMtbWFza1wiPlxuICAgICAgPGRpdiBjbGFzcz1cImhzLWxvYWRlclwiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PlxuICAgIDwvZGl2PmA7XG4gICAgfVxuXG4gICAgdXBkYXRlUGFuZWxzQ29udGFpbmVySGVpZ2h0KCl7XG4gICAgICB0aGlzLmdldFBhbmVsc0NvbnRhaW5lcigpLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2V0Q3VycmVudFBhbmVsSGVpZ2h0KCk7XG4gICAgICAvL3RoaXMucGFuZWxzQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2V0Q3VycmVudFBhbmVsSGVpZ2h0KClcbiAgICB9XG5cbiAgICB1cGRhdGVQYW5lbHNQb3NpdGlvbihjdXJyZW50U3RlcCl7XG4gICAgICBjb25zdCBwYW5lbHMgPSB0aGlzLnBhbmVscztcbiAgICAgIGNvbnN0IHBhbmVsV2lkdGggPSB0aGlzLnBhbmVsV2lkdGg7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFuZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHBhbmVsc1tpXS5jbGFzc0xpc3QucmVtb3ZlKFxuICAgICAgICAgICAnbW92aW5nSW4nLFxuICAgICAgICAgICAnbW92aW5nT3V0QmFja3dhcmQnLFxuICAgICAgICAgICAnbW92aW5nT3V0Rm9yd2FyZCdcbiAgICAgICAgKTtcblxuICAgICAgICBpZihpICE9PSBjdXJyZW50U3RlcCl7XG4gICAgICAgICAgaWYoaSA8IGN1cnJlbnRTdGVwKSBwYW5lbHNbaV0uY2xhc3NMaXN0LmFkZCgnbW92aW5nT3V0QmFja3dhcmQnKTtcbiAgICAgICAgICBlbHNlIGlmKCBpID4gY3VycmVudFN0ZXAgKSBwYW5lbHNbaV0uY2xhc3NMaXN0LmFkZCgnbW92aW5nT3V0Rm9yd2FyZCcpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBwYW5lbHNbaV0uY2xhc3NMaXN0LmFkZCgnbW92aW5nSW4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZVBhbmVsc0NvbnRhaW5lckhlaWdodCgpO1xuICAgIH1cblxuICAgIHVwZGF0ZVBhbmVsc0NvbXBsZXRlKCkge1xuICAgICAgY29uc3QgY29tcGxldGVQYW5lbCA9IHRoaXMuZ2V0UGFuZWxDb21wbGV0ZSgpO1xuICAgICAgaWYoIWNvbXBsZXRlUGFuZWwpIHJldHVyblxuICAgICAgY29uc3QgcGFuZWxzID0gdGhpcy5wYW5lbHM7XG4gICAgICBjb25zdCBwYW5lbFdpZHRoID0gdGhpcy5wYW5lbFdpZHRoO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhbmVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICBwYW5lbHNbaV0uY2xhc3NMaXN0LnJlbW92ZShcbiAgICAgICAgICAgJ21vdmluZ0luJyxcbiAgICAgICAgICAgJ21vdmluZ091dEJhY2t3YXJkJyxcbiAgICAgICAgICAgJ21vdmluZ091dEZvcndhcmQnXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYocGFuZWxzW2ldLmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGUnKSkge1xuICAgICAgICAgIHBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKCdtb3ZpbmdJbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKCdtb3ZpbmdPdXRCYWNrd2FyZCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlUGFuZWxzQ29udGFpbmVySGVpZ2h0KCk7XG4gICAgfVxuXG4gICAgc2V0Q3VycmVudFN0ZXAoY3VycmVudFN0ZXApe1xuICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IGN1cnJlbnRTdGVwO1xuICAgICAgdGhpcy51cGRhdGVQYW5lbHNQb3NpdGlvbihjdXJyZW50U3RlcCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xuICAgIGxpbmVhcjogdHJ1ZSxcbiAgICBhbmltYXRpb246IGZhbHNlLFxuICAgIHNlbGVjdG9yczoge1xuICAgICAgc3RlcHM6ICcuc3RlcCcsXG4gICAgICB0cmlnZ2VyOiAnLnN0ZXAtdHJpZ2dlcicsXG4gICAgICBzdGVwcGVyOiAnLmJzLXN0ZXBwZXInXG4gICAgfSxcbiAgICBvbkNoYW5nZTogYXN5bmMgZnVuY3Rpb24oaW5mbykge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuICAgIG9uQ29tcGxldGU6IGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuICAgIG9uUmVzZXQ6IGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH07XG5cbiAgY2xhc3MgSG90U3RlcHBlciB7XG4gICAgY29uc3RydWN0b3IgKGVsZW1lbnQsIF9vcHRpb25zID0ge30pIHtcbiAgICAgIGlmKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCk7XG4gICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IDA7XG4gICAgICB0aGlzLl9zdGVwc0NvdW50ID0gMDtcbiAgICAgIHRoaXMuX3N0ZXBzQ29udGVudHMgPSBbXTtcbiAgICAgIHRoaXMuX2VsZW1lbnRzID0ge307XG5cbiAgICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgICAgLi4uREVGQVVMVF9PUFRJT05TLFxuICAgICAgICAuLi5fb3B0aW9uc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5vcHRpb25zLnNlbGVjdG9ycyA9IHtcbiAgICAgICAgLi4uREVGQVVMVF9PUFRJT05TLnNlbGVjdG9ycyxcbiAgICAgICAgLi4udGhpcy5vcHRpb25zLnNlbGVjdG9yc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5wYW5lbHMgPSBuZXcgUGFuZWxzKHRoaXMuX2VsZW1lbnQpO1xuICAgICAgdGhpcy5zdGVwcyA9IG5ldyBTdGVwcyh0aGlzLl9lbGVtZW50KTtcbiAgICAgIHRoaXMuX3N0ZXBzQ291bnQgPSB0aGlzLnN0ZXBzLmdldFN0ZXBzUXVhbnRpdHkoKTtcbiAgICAgIHRoaXMuYWRkQ2xhc3NlcygpO1xuICAgICAgdGhpcy5hZGRIYW5kbGVycygpO1xuICAgICAgdGhpcy5hZGRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBhc3luYyBuZXh0ICgpIHtcbiAgICAgIGxldCByZXNwb25zZTtcbiAgICAgIGxldCBpbmZvID0ge1xuICAgICAgICBzdGVwRnJvbTogdGhpcy5fY3VycmVudEluZGV4LFxuICAgICAgICBzdGVwVG86IHRoaXMuX2N1cnJlbnRJbmRleCArIDEsXG4gICAgICAgIHRvdGFsU3RlcHM6IHRoaXMuX3N0ZXBzQ291bnQsXG4gICAgICAgIG1vdmU6ICdmb3J3YXJkJ1xuICAgICAgfTtcbiAgICAgIGlmKHRoaXMuX2N1cnJlbnRJbmRleCArIDEgPj0gdGhpcy5fc3RlcHNDb3VudCkge1xuICAgICAgICBpbmZvLm1vdmUgPSAnY29tcGxldGUnO1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMub25Db21wbGV0ZShpbmZvKTtcbiAgICAgICAgaWYocmVzcG9uc2UgPT09IGZhbHNlKSByZXR1cm4gZmFsc2VcbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fc3RlcHNDb3VudDtcbiAgICAgICAgdGhpcy5zdGVwcy5zZXRDdXJyZW50U3RlcCh0aGlzLl9jdXJyZW50SW5kZXgpO1xuICAgICAgICB0aGlzLnBhbmVscy51cGRhdGVQYW5lbHNDb21wbGV0ZSgpO1xuICAgICAgICB0aGlzLm1hbmFnZUhhbmRsZXJzKGluZm8pO1xuICAgICAgICBhd2FpdCB0aGlzLmNvbXBsZXRlKCk7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9uQ2hhbmdlKGluZm8pO1xuICAgICAgaWYocmVzcG9uc2UgPT09IGZhbHNlKSByZXR1cm4gZmFsc2VcbiAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCArPSAxO1xuICAgICAgdGhpcy5zdGVwcy5zZXRDdXJyZW50U3RlcCh0aGlzLl9jdXJyZW50SW5kZXgpO1xuICAgICAgdGhpcy5wYW5lbHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgIHRoaXMubWFuYWdlSGFuZGxlcnMoaW5mbyk7XG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cblxuICAgIGFzeW5jIHByZXZpb3VzICgpIHtcbiAgICAgIGlmKHRoaXMuX2N1cnJlbnRJbmRleCAtIDEgPCAwKSByZXR1cm5cbiAgICAgIGxldCBpbmZvID0ge1xuICAgICAgICBzdGVwRnJvbTogdGhpcy5fY3VycmVudEluZGV4LFxuICAgICAgICBzdGVwVG86IHRoaXMuX2N1cnJlbnRJbmRleCAtIDEsXG4gICAgICAgIHRvdGFsU3RlcHM6IHRoaXMuX3N0ZXBzQ291bnQsXG4gICAgICAgIG1vdmU6ICdiYWNrd2FyZCdcbiAgICAgIH07XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9uQ2hhbmdlKGluZm8pO1xuICAgICAgaWYocmVzcG9uc2UgPT09IGZhbHNlKSByZXR1cm4gZmFsc2VcbiAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCAtPSAxO1xuICAgICAgdGhpcy5zdGVwcy5zZXRDdXJyZW50U3RlcCh0aGlzLl9jdXJyZW50SW5kZXgpO1xuICAgICAgdGhpcy5wYW5lbHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgIHRoaXMubWFuYWdlSGFuZGxlcnMoaW5mbyk7XG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH1cblxuICAgIGFzeW5jIHJlc2V0ICgpIHtcbiAgICAgIGxldCBpbmZvID0ge1xuICAgICAgICBzdGVwRnJvbTogdGhpcy5fY3VycmVudEluZGV4LFxuICAgICAgICBzdGVwVG86IDAsXG4gICAgICAgIHRvdGFsU3RlcHM6IHRoaXMuX3N0ZXBzQ291bnQsXG4gICAgICAgIG1vdmU6ICdyZXNldCdcbiAgICAgIH07XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9uUmVzZXQoaW5mbyk7XG4gICAgICBpZihyZXNwb25zZSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZVxuICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gMDtcbiAgICAgIHRoaXMuc3RlcHMuc2V0Q3VycmVudFN0ZXAodGhpcy5fY3VycmVudEluZGV4KTtcbiAgICAgIHRoaXMucGFuZWxzLnNldEN1cnJlbnRTdGVwKHRoaXMuX2N1cnJlbnRJbmRleCk7XG4gICAgICB0aGlzLm1hbmFnZUhhbmRsZXJzKGluZm8pO1xuICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9XG5cbiAgICBjb21wbGV0ZSAoKSB7XG4gICAgICBpZih0aGlzLm9wdGlvbnMuYW5pbWF0aW9uID09PSB0cnVlKVxuICAgICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpO1xuICAgICAgaWYodGhpcy5fZWxlbWVudHMuYnRuUHJldikgdGhpcy5fZWxlbWVudHMuYnRuUHJldi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBpZih0aGlzLl9lbGVtZW50cy5idG5OZXh0KSB0aGlzLl9lbGVtZW50cy5idG5OZXh0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBhc3luYyBvbkNoYW5nZSAoaW5mbykge1xuICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdsb2FkaW5nJyk7XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9wdGlvbnMub25DaGFuZ2UuYmluZCh0aGlzKShpbmZvKTtcbiAgICAgIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuXG4gICAgYXN5bmMgb25Db21wbGV0ZSAoaW5mbykge1xuICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdsb2FkaW5nJyk7XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9wdGlvbnMub25Db21wbGV0ZS5iaW5kKHRoaXMpKGluZm8pO1xuICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nJyk7XG4gICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG5cbiAgICBhc3luYyBvblJlc2V0IChpbmZvKSB7XG4gICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2xvYWRpbmcnKTtcbiAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHRoaXMub3B0aW9ucy5vblJlc2V0LmJpbmQodGhpcykoaW5mbyk7XG4gICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmcnKTtcbiAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cblxuICAgIGFkZENsYXNzZXMoKSB7XG4gICAgICB0aGlzLl9lbGVtZW50LmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz1cImhzLW1hc2tcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJocy1sb2FkZXJcIj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48L2Rpdj5cbiAgICA8L2Rpdj5gO1xuICAgIH1cblxuICAgIGFkZEhhbmRsZXJzKCkge1xuICAgICAgbGV0IGZvb3RlciA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmhzLWZvb3RlcicpO1xuICAgICAgaWYoIWZvb3RlcikgcmV0dXJuXG4gICAgICB0aGlzLl9lbGVtZW50cy5idG5OZXh0ID0gZm9vdGVyLnF1ZXJ5U2VsZWN0b3IoJy5idG4tbmV4dCcpO1xuICAgICAgdGhpcy5fZWxlbWVudHMuYnRuUHJldiA9IGZvb3Rlci5xdWVyeVNlbGVjdG9yKCcuYnRuLXByZXYnKTtcbiAgICAgIGlmKHRoaXMuX2VsZW1lbnRzLmJ0blByZXYpIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYuZGlzYWJsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIG1hbmFnZUhhbmRsZXJzKGluZm8pIHtcbiAgICAgIGlmKHRoaXMuX2VsZW1lbnRzLmJ0blByZXYpIHRoaXMuX2VsZW1lbnRzLmJ0blByZXYuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGlmKHRoaXMuX2VsZW1lbnRzLmJ0bk5leHQpIHRoaXMuX2VsZW1lbnRzLmJ0bk5leHQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGlmKGluZm8uc3RlcFRvID09IDAgJiYgdGhpcy5fZWxlbWVudHMuYnRuUHJldilcbiAgICAgICAgdGhpcy5fZWxlbWVudHMuYnRuUHJldi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBpZihpbmZvLm1vdmUgPT0gJ2NvbXBsZXRlJyAmJiB0aGlzLl9lbGVtZW50cy5idG5OZXh0KVxuICAgICAgICB0aGlzLl9lbGVtZW50cy5idG5OZXh0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBhZGRMaXN0ZW5lcnMoKSB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemUpO1xuICAgIH1cblxuICAgIHJlc2l6ZSgpIHtcbiAgICAgIHRoaXMucGFuZWxzLnVwZGF0ZVBhbmVsc0NvbnRhaW5lckhlaWdodCgpO1xuICAgIH1cblxuICAgIHVwZGF0ZVBhbmVsKHBhbmVsLCBodG1sKSB7XG4gICAgICBsZXQgZWwgPSB0aGlzLnBhbmVscy5wYW5lbHNbcGFuZWwgLSAxXTtcbiAgICAgIHRoaXMudXBkYXRlRWwoZWwsIGh0bWwpO1xuICAgIH1cblxuICAgIHVwZGF0ZUVsKGVsLCBodG1sKSB7XG4gICAgICBpZih0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuICAgICAgLy9sZXQgZWwgPSB0aGlzLnBhbmVscy5wYW5lbHNbcGFuZWwgLSAxXVxuICAgICAgbGV0IGEgPSAnKGZ1bmN0aW9uKCl7ICc7XG4gICAgICBsZXQgYiA9ICcgfSkoKSc7XG4gICAgICBlbC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgQXJyYXkuZnJvbShlbC5xdWVyeVNlbGVjdG9yQWxsKFwic2NyaXB0XCIpKS5mb3JFYWNoKCBvbGRTY3JpcHQgPT4ge1xuICAgICAgICBjb25zdCBuZXdTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICBBcnJheS5mcm9tKG9sZFNjcmlwdC5hdHRyaWJ1dGVzKVxuICAgICAgICAgIC5mb3JFYWNoKCBhdHRyID0+IG5ld1NjcmlwdC5zZXRBdHRyaWJ1dGUoYXR0ci5uYW1lLCBhdHRyLnZhbHVlKSApO1xuICAgICAgICBuZXdTY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYSArIG9sZFNjcmlwdC5pbm5lckhUTUwgKyBiKSk7XG4gICAgICAgIG9sZFNjcmlwdC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdTY3JpcHQsIG9sZFNjcmlwdCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMucmVzaXplKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIEhvdFN0ZXBwZXI7XG5cbn0pKTtcbiJdfQ==
